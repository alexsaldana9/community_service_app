<p id="notice"><%= notice %></p>
<div id="map"> </div>

<h1>Events</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Category</th>
      <th>User</th>
      <th>Date</th>
      <th>Street Address</th>
      <th>City</th>
      <th>State</th>
      <th>Zipcode</th>
      <th>Description</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= link_to event.name, events_path(:lat => 38.9072, :long => -77.0369) %></td>
        <td><%= event.category.name %></td>
        <td><%= event.user.name %></td>
        <td><%= event.date %></td>
        <td><%= event.street_address %></td>
        <td><%= event.city %></td>
        <td><%= event.state %></td>
        <td><%= event.zipcode %></td>


        <td><%= event.description %></td>


        <td><%= link_to 'Show', event %></td>
        <td><%= link_to 'Edit', edit_event_path(event) %></td>
        <td><%= link_to 'Destroy', event, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Event', new_event_path %>

<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 50%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

<script>
var latitude;
var longitude;

if (!latitude || !longitude){
  latitude = 25.8030828
  longitude = -80.2043746
} else {
  latitude  = <% if !@lat %> "" <%end%>
  longitude = <% if !@lon %> "" <%end%>
  }
</script>

<script>

var map, infoWindow;
function initMap() {

map = new google.maps.Map(document.getElementById('map'), {
  // center: {lat: 25.8030828, lng: -80.2043746},
  center: {lat: latitude, lng: longitude},
  zoom: 14
});

  infoWindow = new google.maps.InfoWindow;

  // Try HTML5 geolocation.
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      console.log(position);
      var pos = {
        //the thing they clicked on's lat and long

        //get the thing they clicked on
        lat: latitude,
        lng: longitude

      };

      var marker = new google.maps.Marker({
      position: pos,
      map: map,
      title: 'Hello World!'
    });

      // infoWindow.setPosition(pos);
      // infoWindow.setContent('Location found.');
      // infoWindow.open(map);
      map.setCenter(pos);
    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });
  } else {
    // Browser doesn't support Geolocation
    handleLocationError(false, infoWindow, map.getCenter());
  }
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
                        'Error: The Geolocation service failed.' :
                        'Error: Your browser doesn\'t support geolocation.');
  infoWindow.open(map);
}
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?v=3&callback=initMap">
</script>
